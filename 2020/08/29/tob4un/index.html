<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>第四章 网络层 | Frank's Blog</title><meta name="description" content="概述网络层主要功能：网络间移动数据，用 hierarchical(分级的）地址转换，向下屏蔽介质差异，与其他网络通信 设备：路由器互联网段或者不同网络基于 IP 地址进行逻辑选择最优路径选择（通过路由表）进行包转化 IP 地址和子网包&#x2F;datagram（数据报）：首部长度最大值：60byte版本：4bit 4（IPV4），6（IPV6）首部长度：4bit，最大 60byte服务类型：8bit，一般"><meta name="keywords" content="Frank Shi"><meta name="author" content="Frank Shi"><meta name="copyright" content="Frank Shi"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/2020/08/29/tob4un/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="yandex-verification" content="{&quot;theme_color&quot;:{&quot;enable&quot;:true,&quot;main&quot;:&quot;#49B1F5&quot;,&quot;paginator&quot;:&quot;#00c4b6&quot;,&quot;button_hover&quot;:&quot;#FF7242&quot;,&quot;text_selection&quot;:&quot;#00c4b6&quot;,&quot;link_color&quot;:&quot;#99a9bf&quot;,&quot;meta_color&quot;:&quot;#858585&quot;,&quot;hr_color&quot;:&quot;#A4D8FA&quot;,&quot;code_foreground&quot;:&quot;#F47466&quot;,&quot;code_background&quot;:&quot;rgba(27, 31, 35, .05)&quot;,&quot;toc_color&quot;:&quot;#00c4b6&quot;,&quot;blockquote_padding_color&quot;:&quot;#49b1f5&quot;,&quot;blockquote_background_color&quot;:&quot;#49b1f5&quot;}}"/><meta property="og:type" content="article"><meta property="og:title" content="第四章 网络层"><meta property="og:url" content="http://yoursite.com/2020/08/29/tob4un/"><meta property="og:site_name" content="Frank's Blog"><meta property="og:description" content="概述网络层主要功能：网络间移动数据，用 hierarchical(分级的）地址转换，向下屏蔽介质差异，与其他网络通信 设备：路由器互联网段或者不同网络基于 IP 地址进行逻辑选择最优路径选择（通过路由表）进行包转化 IP 地址和子网包&#x2F;datagram（数据报）：首部长度最大值：60byte版本：4bit 4（IPV4），6（IPV6）首部长度：4bit，最大 60byte服务类型：8bit，一般"><meta property="og:image" content="https://pic2.zhimg.com/v2-e712b84789cb7c5271eb2eca8e4c8fe6_r.jpg"><meta property="article:published_time" content="2020-08-29T02:32:52.000Z"><meta property="article:modified_time" content="2020-08-29T02:35:25.962Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '4.2.1',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: true    
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-08-29 10:35:25'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Frank's Blog" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">20</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">1</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#概述"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IP-地址和子网"><span class="toc-number">2.</span> <span class="toc-text">IP 地址和子网</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#网络层地址"><span class="toc-number">2.1.</span> <span class="toc-text">网络层地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分类"><span class="toc-number">2.1.1.</span> <span class="toc-text">分类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#子网"><span class="toc-number">2.2.</span> <span class="toc-text">子网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#子网掩码"><span class="toc-number">2.2.1.</span> <span class="toc-text">子网掩码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第三层设备"><span class="toc-number">3.</span> <span class="toc-text">第三层设备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#路径选择"><span class="toc-number">3.1.</span> <span class="toc-text">路径选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#地址分配"><span class="toc-number">3.2.</span> <span class="toc-text">地址分配</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ARP-protocol"><span class="toc-number">4.</span> <span class="toc-text">ARP protocol</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#默认网关"><span class="toc-number">4.1.</span> <span class="toc-text">默认网关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#proxy-arp"><span class="toc-number">4.2.</span> <span class="toc-text">proxy arp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网络层服务"><span class="toc-number">5.</span> <span class="toc-text">网络层服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#面向连接的服务-Connection-oriented-network-services"><span class="toc-number">5.1.</span> <span class="toc-text">面向连接的服务 Connection oriented network services</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#电路交换-Circuit-switched"><span class="toc-number">5.2.</span> <span class="toc-text">电路交换 Circuit switched</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#无连接网络服务-Connectionless-network-services"><span class="toc-number">5.3.</span> <span class="toc-text">无连接网络服务 Connectionless network services</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#报文交换-Packet-switched"><span class="toc-number">5.4.</span> <span class="toc-text">报文交换 Packet switched</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#路由和路由协议"><span class="toc-number">6.</span> <span class="toc-text">路由和路由协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#路由协议"><span class="toc-number">6.1.</span> <span class="toc-text">路由协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#路由表-routing-table"><span class="toc-number">6.2.</span> <span class="toc-text">路由表 routing table</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#static"><span class="toc-number">6.2.1.</span> <span class="toc-text">static</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamic"><span class="toc-number">6.2.2.</span> <span class="toc-text">dynamic</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#routing-protocol-和-routed-protocol"><span class="toc-number">6.3.</span> <span class="toc-text">routing protocol 和 routed protocol</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RIP"><span class="toc-number">6.3.1.</span> <span class="toc-text">RIP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IGRP-EIGRP"><span class="toc-number">6.3.2.</span> <span class="toc-text">IGRP EIGRP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OSPF"><span class="toc-number">6.3.3.</span> <span class="toc-text">OSPF</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VLSM"><span class="toc-number">7.</span> <span class="toc-text">VLSM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#路由聚集（ROUTE-aggregation）"><span class="toc-number">7.1.</span> <span class="toc-text">路由聚集（ROUTE aggregation）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ICMP"><span class="toc-number">8.</span> <span class="toc-text">ICMP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#格式"><span class="toc-number">8.1.</span> <span class="toc-text">格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#两种-ICMP-报文"><span class="toc-number">8.2.</span> <span class="toc-text">两种 ICMP 报文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#差错报告报文的数据字段"><span class="toc-number">8.2.1.</span> <span class="toc-text">差错报告报文的数据字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PING"><span class="toc-number">8.3.</span> <span class="toc-text">PING</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://pic2.zhimg.com/v2-e712b84789cb7c5271eb2eca8e4c8fe6_r.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Frank's Blog</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">第四章 网络层</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-08-29T02:32:52.000Z" title="发表于 2020-08-29 10:32:52">2020-08-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-08-29T02:35:25.962Z" title="更新于 2020-08-29 10:35:25">2020-08-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%92%E8%81%94%E7%BD%91%E8%AE%A1%E7%AE%97%E5%A4%8D%E4%B9%A0/">互联网计算复习</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">1.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>5分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>网络层主要功能：网络间移动数据，用 hierarchical(分级的）地址转换，向下屏蔽介质差异，与其他网络通信<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597565562615-78383b4f-469f-445a-847b-2fedb74e186f.png#align=left&display=inline&height=438&margin=%5Bobject%20Object%5D&originHeight=438&originWidth=986&status=done&style=none&width=986" alt=""></p>
<p>设备：路由器<br>互联网段或者不同网络<br>基于 IP 地址进行逻辑选择<br>最优路径选择（通过路由表）<br>进行包转化</p>
<h2 id="IP-地址和子网"><a href="#IP-地址和子网" class="headerlink" title="IP 地址和子网"></a>IP 地址和子网</h2><p>包/datagram（数据报）：<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597565599597-a621b8b4-1913-4c63-adeb-67d4221268e6.png#align=left&display=inline&height=836&margin=%5Bobject%20Object%5D&originHeight=836&originWidth=1378&status=done&style=none&width=1378" alt=""><br>首部长度最大值：60byte<br>版本：4bit 4（IPV4），6（IPV6）<br>首部长度：4bit，最大 60byte<br>服务类型：8bit，一般不用<br>总长度：16bit，65535bytes，不超过最大传送单元（MTU）<br>标识：16bit ，计数器。相同标识为同一层原始报文，可以进行合并<br>标志：3bit 最高位为 0，DF：是否允许分辨（0 表示可以分片）MF（0 最后的分片）<br>片位移：13bit，以 8byte 为一个便宜单位。<br>分片：独立形成首部<br>生存时间 TTl：8bit，数据包在网络中可通过的路由器数的最大值<br>协议：8bit，指出将数据部分交给哪一个进程<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597565562309-3c2bf889-603e-4107-950b-2f3d851bbadd.png#align=left&display=inline&height=322&margin=%5Bobject%20Object%5D&originHeight=322&originWidth=734&status=done&style=none&width=734" alt=""><br>首部地址校验和：16bit<br>源地址，目的地址：4bytes</p>
<h3 id="网络层地址"><a href="#网络层地址" class="headerlink" title="网络层地址"></a>网络层地址</h3><p>IP 地址分为：networkID 和 hostID<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597565562476-ff1c3ffe-a28a-4d5a-8bc3-41a6784d097f.png#align=left&display=inline&height=568&margin=%5Bobject%20Object%5D&originHeight=568&originWidth=1106&status=done&style=none&width=1106" alt=""><br>networkid 用来标识相同网段，区分网段设备<br>hostid，一个网段内特定设备</p>
<h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597565562218-120a3bfc-e699-4c22-b4a2-309e41d74379.png#align=left&display=inline&height=398&margin=%5Bobject%20Object%5D&originHeight=398&originWidth=1002&status=done&style=none&width=1002" alt=""><br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/jpeg/392607/1597565599625-28aace57-3fe9-4480-a4eb-49d6235e39fe.jpeg#align=left&display=inline&height=626&margin=%5Bobject%20Object%5D&originHeight=626&originWidth=1144&status=done&style=none&width=1144" alt=""><br>主机数：一个地址用于 networkkid（全 0），最后一个用于广播地址<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/jpeg/392607/1597565562411-91509a8a-fe3f-49c2-9687-41be357f709f.jpeg#align=left&display=inline&height=250&margin=%5Bobject%20Object%5D&originHeight=250&originWidth=1154&status=done&style=none&width=1154" alt=""><br>如果两个设备判断是在同一个网段，则可以直接通信，不需要三层设备的转发<br>广播对本网段的所用设备进行通信<br>受限广播地址：255.255.255.255 不可跨路由器</p>
<h3 id="子网"><a href="#子网" class="headerlink" title="子网"></a>子网</h3><p>subnet 也是一个网段<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/jpeg/392607/1597565562419-2a6666a9-f90d-4f76-b1f6-0260206a3275.jpeg#align=left&display=inline&height=420&margin=%5Bobject%20Object%5D&originHeight=420&originWidth=1258&status=done&style=none&width=1258" alt=""><br>最少向 host 借两位<br>（如果借一位取 0 是 networkID，取 1 是广播地址）<br>副作用：全 0 和全 1 不可用</p>
<h4 id="子网掩码"><a href="#子网掩码" class="headerlink" title="子网掩码"></a>子网掩码</h4><p>别名：extended network prefix<br>定义我们可以使用多少位来构建网络和主机地址<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597565562262-0e16afc8-331b-4c15-bebd-5a7430a10b05.png#align=left&display=inline&height=204&margin=%5Bobject%20Object%5D&originHeight=204&originWidth=792&status=done&style=none&width=792" alt=""><br>（注意全 0 和全 1 不可用需要减 2）</p>
<h2 id="第三层设备"><a href="#第三层设备" class="headerlink" title="第三层设备"></a>第三层设备</h2><p>路由器<br>有多个端口，每个端口连接不同的网段（要占据对应网络地址）。端口之间的网段地址不能相同，否则会有歧义（不知道想哪一个端口转发）</p>
<h3 id="路径选择"><a href="#路径选择" class="headerlink" title="路径选择"></a>路径选择</h3><p>基于 IP 地址的逻辑规范<br>形成报文-》加目的 IP 地址-〉放入帧-》发布在总线上</p>
<h3 id="地址分配"><a href="#地址分配" class="headerlink" title="地址分配"></a>地址分配</h3><p>静态地址分配：独立的设备有自己的 ip 地址<br>动态地址分配：<img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597565562332-8c2df520-3720-43ee-a370-bbb018611722.png#align=left&display=inline&height=132&margin=%5Bobject%20Object%5D&originHeight=132&originWidth=666&status=done&style=none&width=666" alt=""></p>
<h2 id="ARP-protocol"><a href="#ARP-protocol" class="headerlink" title="ARP protocol"></a>ARP protocol</h2><p>地址解析协议（Address Resolution Protocol），是根据 IP 地址获取物理地址的一个 TCP/IP 协议<br>ARP table/arp 缓存<br>如果 arptable 没有对应的 MAC 地址，发送 ARP 请求，发送广播（将 mac 地址设为全 1），某主机发现 ip 地址与帧内的 ip 地址相匹配，则发送 arpreply，对应主机将 mac 地址写入条目。<br>arp 请求是<strong>本地化</strong>的（本网段请求）<br>不在本网段：1.default gateway（默认网关）2.proxy arp（代理 arp）</p>
<h3 id="默认网关"><a href="#默认网关" class="headerlink" title="默认网关"></a>默认网关</h3><p>网关：通讯和服务。配置 ip 地址时一般要配置网关<br>默认网关：路由器端口的 IP 地址</p>
<h3 id="proxy-arp"><a href="#proxy-arp" class="headerlink" title="proxy arp"></a>proxy arp</h3><p>一般启动在路由器上<br>路由器收到后，将对应端口的 mac 地址返回，在另一个端口进行转发<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/jpeg/392607/1597565562549-cc70dc25-d1d6-4f00-9952-68e1e6083494.jpeg#align=left&display=inline&height=508&margin=%5Bobject%20Object%5D&originHeight=508&originWidth=818&status=done&style=none&width=818" alt=""></p>
<h2 id="网络层服务"><a href="#网络层服务" class="headerlink" title="网络层服务"></a>网络层服务</h2><h3 id="面向连接的服务-Connection-oriented-network-services"><a href="#面向连接的服务-Connection-oriented-network-services" class="headerlink" title="面向连接的服务 Connection oriented network services"></a>面向连接的服务 Connection oriented network services</h3><p>建立会话连接（逻辑连接）后进行传输，实现可靠传输</p>
<h3 id="电路交换-Circuit-switched"><a href="#电路交换-Circuit-switched" class="headerlink" title="电路交换 Circuit switched"></a>电路交换 Circuit switched</h3><p>建立虚电路的关系，不做路径选择<br>更可靠。会使利用效率低</p>
<h3 id="无连接网络服务-Connectionless-network-services"><a href="#无连接网络服务-Connectionless-network-services" class="headerlink" title="无连接网络服务 Connectionless network services"></a>无连接网络服务 Connectionless network services</h3><p>对突发传输有效<br>报文可能会丢失</p>
<h3 id="报文交换-Packet-switched"><a href="#报文交换-Packet-switched" class="headerlink" title="报文交换 Packet switched"></a>报文交换 Packet switched</h3><p>原始的报文分为子报文，自行发送（不一定在同一路径）<br>第三次服务是基于无连接和报文交换的</p>
<h2 id="路由和路由协议"><a href="#路由和路由协议" class="headerlink" title="路由和路由协议"></a>路由和路由协议</h2><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/jpeg/392607/1597565599606-7baf58dc-6893-485e-ab53-5d12b19e41db.jpeg#align=left&display=inline&height=600&margin=%5Bobject%20Object%5D&originHeight=600&originWidth=1422&status=done&style=none&width=1422" alt=""><br>在不同的路由器形成新的帧</p>
<h3 id="路由协议"><a href="#路由协议" class="headerlink" title="路由协议"></a>路由协议</h3><p>IP 是网络层协议，跨网络路由协议</p>
<h3 id="路由表-routing-table"><a href="#路由表-routing-table" class="headerlink" title="路由表 routing table"></a>路由表 routing table</h3><p>非固定的，路由器启动后生成的</p>
<h4 id="static"><a href="#static" class="headerlink" title="static"></a>static</h4><p>由网络管理员手动配置，不能自动修改<br>优点：可以隐藏部分路由，更安全<br>进行简单配置/默认路由</p>
<h4 id="dynamic"><a href="#dynamic" class="headerlink" title="dynamic"></a>dynamic</h4><p>根据不同的协议，进行学习不同信息来生成路由表。（RIP, IGRP, EIGRP, OSPF ）<br>优点：自动维护，适应网络变化</p>
<h3 id="routing-protocol-和-routed-protocol"><a href="#routing-protocol-和-routed-protocol" class="headerlink" title="routing protocol 和 routed protocol"></a>routing protocol 和 routed protocol</h3><p>前者是主动的操作，用于生成各种路由表的信息一般指动态路由表里的协议<br>后者是路由器之间，进行转发判断（IP，ipx）<br>关系:routing protocol determines how routed protocol is routed<br>routing protocols</p>
<ul>
<li>IGP：内部 Interior Gateway Protocols (RIP, IGRP, EIGRP,<br>OSPF) 自系统内部（逻辑划分）<ul>
<li>Distance-Vector Protocols (RIP, IGRP):邻居的视角（跳数）<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597565563129-c72dfb71-e07a-4af5-8e24-4b46243616f1.png#align=left&display=inline&height=736&margin=%5Bobject%20Object%5D&originHeight=736&originWidth=1278&status=done&style=none&width=1278" alt=""><br>时间代价。  （数字是跳数 hop）</li>
<li>Link State Protocols (OSPF):全局视角。shortest path<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597565563121-953a344e-764d-42f7-8a6f-6fc0117f2d0a.png#align=left&display=inline&height=740&margin=%5Bobject%20Object%5D&originHeight=740&originWidth=1238&status=done&style=none&width=1238" alt=""></li>
</ul>
</li>
<li>EGP：外部 Exterior Gateway Protocols (EGP, BGP)自系统之间<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/jpeg/392607/1597565562566-0bab7d67-dc74-4af0-a384-352a5c97e5b2.jpeg#align=left&display=inline&height=702&margin=%5Bobject%20Object%5D&originHeight=702&originWidth=1382&status=done&style=none&width=1382" alt=""></li>
</ul>
<h4 id="RIP"><a href="#RIP" class="headerlink" title="RIP"></a>RIP</h4><p>Route Information Protocol 路由信息协议<br>评判标准仅基于跳数（hop）<br>最远可达跳数 15<br>每 30s 做一次广播<br>不会选择最快路径，选择跳数最少的路径<br>RIP v2 是主播，v1 用广播</p>
<h4 id="IGRP-EIGRP"><a href="#IGRP-EIGRP" class="headerlink" title="IGRP EIGRP"></a>IGRP EIGRP</h4><p>Interior Gateway Route Protocol。Enhanced IGRP<br>思科内部<br>评判标准：跳数，带宽，负载<br>跳数最远：255<br>每 90s 做一次更新</p>
<h4 id="OSPF"><a href="#OSPF" class="headerlink" title="OSPF"></a>OSPF</h4><p>Open Shortest Path First.      开放式最短路径优先<br>评判依据：带宽<br>消耗更多的 cpu 和内存</p>
<h2 id="VLSM"><a href="#VLSM" class="headerlink" title="VLSM"></a>VLSM</h2><p>Variable-Length Subnet Masks<br>使用 VLSM 原因</p>
<blockquote>
<p>：1. 允许在同一个网络环境下使用更多的子网掩码 2.使用地址最大化 3.IPV4 到 IPV6 有效过渡<br>优点：有效利用 IP 地址；更好的路由聚合<br>支持 VLSM 的协议：（支持报文包含子网掩码）<br>Open Shortest Path First (OSPF)<br>Integrated Intermediate System to Intermediate System (Integrated IS-IS)<br>Enhanced Interior Gateway Routing Protocol(EIGRP)<br>RIP v2<br>Static routing.</p>
</blockquote>
<p>步骤：</p>
<ol>
<li>先满足最大的子网</li>
<li></li>
</ol>
<h3 id="路由聚集（ROUTE-aggregation）"><a href="#路由聚集（ROUTE-aggregation）" class="headerlink" title="路由聚集（ROUTE aggregation）"></a>路由聚集（ROUTE aggregation）</h3><p>无类别域间路由（Classless Inter-Domain Routing、CIDR）是一个用于给用户分配 IP 地址以及在互联网上有效地路由 IP 数据包的对 IP 地址进行归类的方法<br>通过 cidr 和 vlsm 把小的路由合并变成大子网。<br>优点：减少路由表的条目；将拓扑变化进行隔离。</p>
<h2 id="ICMP"><a href="#ICMP" class="headerlink" title="ICMP"></a>ICMP</h2><p>因特网控制报文协议 Internet Control Message Protocol<br>为了提高数据报交付成功的机会<br>允许主机或路由器报告差错情况和提供有关异常情况的报告<br>属于 IP 层的协议，ICMP 报文作为 IP 层数据报的数据，加上数据报的首部，<br>组成 IP 数据报发送出去</p>
<h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597585504118-32c7a5bd-b48f-4665-a9b1-5bf405cedb16.png#align=left&display=inline&height=650&margin=%5Bobject%20Object%5D&originHeight=650&originWidth=1252&status=done&style=none&width=1252" alt=""></p>
<h3 id="两种-ICMP-报文"><a href="#两种-ICMP-报文" class="headerlink" title="两种 ICMP 报文"></a>两种 ICMP 报文</h3><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597585504239-3d9c73d0-86a0-4773-b1e8-aaea4ef28f5d.png#align=left&display=inline&height=810&margin=%5Bobject%20Object%5D&originHeight=810&originWidth=1194&status=done&style=none&width=1194" alt=""><br>目的站不可到达：<img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/jpeg/392607/1597585504133-2d96eb60-07fa-4f94-8692-ed3882eeff79.jpeg#align=left&display=inline&height=338&margin=%5Bobject%20Object%5D&originHeight=338&originWidth=682&status=done&style=none&width=682" alt=""></p>
<h4 id="差错报告报文的数据字段"><a href="#差错报告报文的数据字段" class="headerlink" title="差错报告报文的数据字段"></a>差错报告报文的数据字段</h4><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597585504096-4990600d-1775-47c8-938d-327b0f002f7b.png#align=left&display=inline&height=410&margin=%5Bobject%20Object%5D&originHeight=410&originWidth=986&status=done&style=none&width=986" alt=""><br>不应发送 ICPM 差错报文的情况<br><img src= "/img/loading.gif" data-lazy-src="https://cdn.nlark.com/yuque/0/2020/png/392607/1597585504099-a221dc8f-d4aa-4196-b7ee-40aaf06dfde6.png#align=left&display=inline&height=436&margin=%5Bobject%20Object%5D&originHeight=436&originWidth=892&status=done&style=none&width=892" alt=""></p>
<h3 id="PING"><a href="#PING" class="headerlink" title="PING"></a>PING</h3><p>是用 ICMP 的 echo request 和 echo reply 消息来实现/PING 使用 ICMP 回送请求与回送回答报文（两个报文）<br>ping 用来测试两个主机之间的连通性<br>PING 是应用层直接使用网络 IMCP 的例子，未经过 TCP 和 UDP</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Frank Shi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/08/29/tob4un/">http://yoursite.com/2020/08/29/tob4un/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Frank's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://pic2.zhimg.com/v2-e712b84789cb7c5271eb2eca8e4c8fe6_r.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/08/29/wqvpbi/"><img class="prev-cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">第三章 数据链路层</div></div></a></div><div class="next-post pull-right"><a href="/2020/08/29/esz5cg/"><img class="next-cover" data-lazy-src="https://pic2.zhimg.com/v2-e712b84789cb7c5271eb2eca8e4c8fe6_r.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">往年试卷总结</div></div></a></div></nav></article></main><footer id="footer" style="background-image: url(https://pic2.zhimg.com/v2-e712b84789cb7c5271eb2eca8e4c8fe6_r.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By Frank Shi</div><div class="framework-info"><span>框架 </span><a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>